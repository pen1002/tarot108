<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë™ììŠ¹ íƒ€ë¡œ - ê°œìš´(é–‹é‹) ì†”ë£¨ì…˜</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #0d1117; color: #e6edf3; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: #161b22; padding: 20px; border-radius: 12px; }
        h1 { text-align: center; color: #d29922; }
        label { display: block; margin-top: 15px; color: #8b949e; }
        textarea { width: 100%; padding: 12px; margin-top: 5px; background: #0d1117; border: 1px solid #30363d; color: #c9d1d9; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background-color: #d29922; color: white; border: none; border-radius: 6px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        #result { margin-top: 30px; padding: 20px; background: #0d1117; border-left: 4px solid #d29922; display: none; white-space: pre-wrap; }
        .loading { text-align: center; display: none; color: #d29922; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ™ AI ë™ììŠ¹ íƒ€ë¡œ ìƒë‹´ì†Œ</h1>
    <label>ğŸ“ ë‹¹ì‹ ì˜ ê³ ë¯¼ì„ ë“¤ë ¤ì£¼ì„¸ìš”</label>
    <textarea id="concern" rows="3" placeholder="ì˜ˆ: ì˜¤ëŠ˜ ìƒˆë¡œ ë§Œë‚˜ëŠ” ì‚¬ëŒê³¼ì˜ ì¸ì—°ì€ ì–´ë–¨ê¹Œìš”?"></textarea>
    <button onclick="getTarotReading()">ë™ììŠ¹ì—ê²Œ ì¹´ë“œ ë½‘ê¸° ìš”ì²­</button>
    <div id="loading" class="loading">ë™ììŠ¹ì´ ì •ì„±ê» ì¹´ë“œë¥¼ ê³ ë¥´ê³  ìˆìŠµë‹ˆë‹¤...</div>
    <div id="result"></div>
</div>

<script>
async function getTarotReading() {
    const concern = document.getElementById("concern").value.trim();
    const resultBox = document.getElementById("result");
    const loading = document.getElementById("loading");

    if(!concern) { alert("ê³ ë¯¼ì„ ì…ë ¥í•˜ì…”ì•¼ ê¸°ìš´ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."); return; }

    loading.style.display = "block";
    resultBox.style.display = "none";

    try {
        const response = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "claude-3-haiku-20240307",
                max_tokens: 1500,
                system: "ë‹¹ì‹ ì€ 30ë…„ ê²½ë ¥ì˜ íƒ€ë¡œ ë§ˆìŠ¤í„°ì´ì ì¸ìí•œ ë™ììŠ¹ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë½‘ì€ 3ì¥ì˜ ê°€ìƒ ì¹´ë“œë¥¼ ìƒì •í•˜ì—¬ [ê³¼ê±°-í˜„ì¬-ë¯¸ë˜]ì˜ íë¦„ìœ¼ë¡œ í•´ì„í•˜ê³ , ë§ˆì§€ë§‰ì—ëŠ” í‰ì•ˆì„ ì£¼ëŠ” '15ì´ˆ ëª…ìƒ ë©”ì‹œì§€'ë¥¼ ë‚¨ê¸°ì‹­ì‹œì˜¤. ëª¨ë“  ë§íˆ¬ëŠ” ëƒ‰ì² í•˜ë©´ì„œë„ ìì• ë¡œìš´ ì‹¤ì¥ í†¤ì„ ìœ ì§€í•˜ì‹­ì‹œì˜¤.",
                messages: [{ role: "user", content: `ê³ ë¯¼ ë‚´ìš©: ${concern}` }]
            })
        });

        const data = await response.json();
        const text = data.content[0].text;
        resultBox.innerText = text;
        resultBox.style.display = "block";
        
        // TTS ê¸°ëŠ¥ (15ì´ˆ ëª…ìƒ ë©”ì‹œì§€ ì½ì–´ì£¼ê¸°)
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text.split("15ì´ˆ ëª…ìƒ ë©”ì‹œì§€")[1] || text);
            utterance.lang = 'ko-KR';
            window.speechSynthesis.speak(utterance);
        }
    } catch (e) {
        alert("ê¸°ìš´ì´ ì ì‹œ ë§‰í˜”ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì‹­ì‹œì˜¤.");
    } finally {
        loading.style.display = "none";
    }
}
</script>
</body>
</html>
